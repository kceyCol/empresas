<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptMaker - Gerador de Prompts para IA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/estilos.css">
</head>
<body>
    <div class="container py-4">
        <!-- Header com informações do usuário -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-center">PromptMaker</h1>
            <div class="d-flex align-items-center gap-3">
                <span class="text-muted">Olá, {{ user_name }}!</span>
                <a href="{{ url_for('config') }}" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-gear"></i> Configuração
                </a>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">
                    <i class="bi bi-box-arrow-right"></i> Sair
                </a>
            </div>
        </div>
        
        <!-- Resto do conteúdo existente -->
        <h1 class="mb-4 text-center">PromptMaker - Gerador de Prompts para Empresas</h1>
        
        <!-- Layout de duas colunas -->
        <div class="row">
            <!-- Coluna esquerda: Tipos de prompt -->
            <div class="col-md-6 col-lg-5">
                <div class="card p-4 shadow-sm h-100">
                    <h5 class="mb-4">Selecione o tipo de prompt empresarial:</h5>
                    
                    <!-- Seção: Gestão Empresarial -->
                    <div class="categoria-gestao">
                        <h6 class="text-primary mb-3"><i class="bi bi-building"></i> Gestão Empresarial</h6>
                        <div class="row row-cols-1 row-cols-lg-2 g-3">
                            <div class="col">
                                <div class="card tipo-card selected card-tooltip" data-tipo="resumo_executivo" data-descricao="Transforma relatórios longos em resumos estratégicos para tomada de decisão rápida.">
                                    <div class="tooltip-text">Transforma relatórios longos em resumos estratégicos para tomada de decisão rápida.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">📊</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Resumo Executivo</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="analise_swot_concorrente">
                                    <div class="tooltip-text">Analisa um concorrente e organiza as informações no framework SWOT automaticamente.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">🎯</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Análise SWOT</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="plano_acao_reuniao">
                                    <div class="tooltip-text">Converte discussões de reuniões em um plano de ação claro com responsáveis.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">📋</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Plano de Ação</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="simplificador_relatorio_financeiro">
                                    <div class="tooltip-text">Traduz dados financeiros complexos em uma explicação clara para toda a empresa.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">💰</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Relatório Financeiro</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção: Marketing e Vendas -->
                    <div class="categoria-marketing">
                        <h6 class="text-success mb-3"><i class="bi bi-megaphone"></i> Marketing e Vendas</h6>
                        <div class="row row-cols-1 row-cols-lg-2 g-3">
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="analise_sentimento_cliente">
                                    <div class="tooltip-text">Analisa avaliações, identificando temas positivos, negativos e sugestões de melhoria.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">😊</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Análise Sentimento</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="elaboracao_email_prospeccao">
                                    <div class="tooltip-text">Cria e-mails de prospecção personalizados e persuasivos para aumentar taxas de resposta.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">📧</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">E-mail Prospecção</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="brainstorm_conteudo_midias_sociais">
                                    <div class="tooltip-text">Gera ideias de posts para redes sociais alinhadas com sua marca e público.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">📱</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Mídias Sociais</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção: Recursos Humanos -->
                    <div class="categoria-rh">
                        <h6 class="text-info mb-3"><i class="bi bi-people"></i> Recursos Humanos</h6>
                        <div class="row row-cols-1 row-cols-lg-2 g-3">
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="criacao_descricao_vaga">
                                    <div class="tooltip-text">Gera descrições de vagas atraentes e estruturadas para atrair os melhores talentos.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">👥</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Descrição Vaga</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="roteiro_entrevista_competencias">
                                    <div class="tooltip-text">Cria roteiros de entrevista com perguntas comportamentais para avaliar competências específicas.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">🎯</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Roteiro de Entrevista por Competências</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção: Licitações -->
                    <div class="categoria-licitacoes">
                        <h6 class="text-warning mb-3"><i class="bi bi-file-earmark-text"></i> Licitações</h6>
                        <div class="row row-cols-1 row-cols-lg-2 g-3">
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="analisador_edital_ficha_resumo">
                                    <div class="tooltip-text">Extrai dados críticos de editais, criando um resumo e checklist de tarefas.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">📄</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Analisador Edital</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="checklist_documentos_habilitacao">
                                    <div class="tooltip-text">Gera um checklist completo de todos os documentos exigidos no edital.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">✅</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Checklist Docs</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="minuta_pedido_esclarecimento_impugnacao">
                                    <div class="tooltip-text">Elabora minutas para questionar ou impugnar pontos específicos de um edital.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">❓</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Minuta Pedido</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="analise_ata_julgamento_sessao">
                                    <div class="tooltip-text">Resume os resultados da sessão, identificando vencedores e motivos de desclassificação.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">⚖️</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Análise Ata</h6>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="card tipo-card card-tooltip" data-tipo="analise_proposta_vencedora_inteligencia_competitiva">
                                    <div class="tooltip-text">Analisa propostas vencedoras para extrair insights e estratégias para futuros pregões.</div>
                                    <div class="card-body text-center py-2">
                                        <div class="card-icon" style="font-size: 1.5rem;">🏆</div>
                                        <h6 class="card-title mb-0" style="font-size: 0.9rem;">Inteligência Competitiva</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Coluna direita: Área de prompt -->
            <div class="col-md-6 col-lg-7">
                <div class="card p-4 shadow-sm h-100">
                    <div class="d-flex flex-column h-100">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Prompt Gerado:</label>
                            <textarea id="outputPrompt" class="form-control" rows="20" readonly placeholder="Clique em um card à esquerda para gerar o prompt automaticamente..." style="resize: vertical; min-height: 400px;"></textarea>
                        </div>
                        <div class="mt-auto">
                            <div class="d-flex flex-wrap gap-2" id="botoesAcoes" style="display:none;">
                                <button id="btnCopiar" class="btn btn-copiar">Copiar Prompt</button>
                                <button class="btn btn-gemini" onclick="abrirIA('gemini')">Abrir Gemini</button>
                                <button class="btn btn-chatgpt" onclick="abrirIA('chatgpt')">Abrir ChatGPT</button>
                                <button class="btn btn-deepseek" onclick="abrirIA('deepseek')">Abrir DeepSeek</button>
                                <button class="btn btn-claude" onclick="abrirIA('claude')">Abrir Claude</button>
                                <button class="btn btn-perplexity" onclick="abrirIA('perplexity')">Abrir Perplexity</button>
                                <button class="btn btn-manus" onclick="abrirIA('manus')">Abrir Manus</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        
    </div>
    
    <script>
        const urlsIA = {
            'gemini': 'https://gemini.google.com/',
            'chatgpt': 'https://chat.openai.com/',
            'deepseek': 'https://chat.deepseek.com/',
            'claude': 'https://claude.ai/',
            'perplexity': 'https://www.perplexity.ai/',
            'manus': 'https://www.manus.im/'
        };
        
        let tipoSelecionado = 'resumo_executivo';
        let tooltipTimeout;
        
        // Detectar se é dispositivo touch
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Adicionar evento de clique aos cards
            document.querySelectorAll('.tipo-card').forEach(card => {
                // Eventos de clique/touch
                card.addEventListener('click', async function(e) {
                    e.preventDefault();
                    
                    // Remover seleção anterior
                    document.querySelectorAll('.tipo-card').forEach(c => {
                        c.classList.remove('selected');
                        c.classList.remove('show-tooltip');
                    });
                    
                    // Adicionar seleção ao card clicado
                    this.classList.add('selected');
                    
                    // Atualizar tipo selecionado
                    tipoSelecionado = this.getAttribute('data-tipo');
                    
                    // Gerar prompt automaticamente
                    await gerarPromptAutomatico(tipoSelecionado);
                });
                
                // Eventos para tooltip em dispositivos touch
                if (isTouchDevice) {
                    card.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        
                        // Limpar timeout anterior
                        clearTimeout(tooltipTimeout);
                        
                        // Remover tooltips de outros cards
                        document.querySelectorAll('.tipo-card').forEach(c => {
                            if (c !== this) c.classList.remove('show-tooltip');
                        });
                        
                        // Mostrar tooltip do card atual
                        this.classList.add('show-tooltip');
                        
                        // Esconder tooltip após 3 segundos
                        tooltipTimeout = setTimeout(() => {
                            this.classList.remove('show-tooltip');
                        }, 3000);
                    });
                } else {
                    // Para dispositivos desktop, adicionar eventos de mouse
                    card.addEventListener('mouseenter', function() {
                        this.classList.add('show-tooltip');
                    });
                    
                    card.addEventListener('mouseleave', function() {
                        this.classList.remove('show-tooltip');
                    });
                }
            });
            
            // Esconder tooltip ao tocar fora (apenas para dispositivos touch)
            if (isTouchDevice) {
                document.addEventListener('touchstart', function(e) {
                    if (!e.target.closest('.tipo-card')) {
                        document.querySelectorAll('.tipo-card').forEach(c => {
                            c.classList.remove('show-tooltip');
                        });
                    }
                });
            }
            
            // Gerar prompt inicial
            gerarPromptAutomatico('resumo_executivo');
        });

        // Nova função para gerar prompt automaticamente
        async function gerarPromptAutomatico(tipo) {
            const outputPrompt = document.getElementById('outputPrompt');
            const botoesAcoes = document.getElementById('botoesAcoes');
            
            // Mostrar feedback de carregamento
            outputPrompt.value = 'Gerando prompt...';
            outputPrompt.style.opacity = '0.6';
            
            try {
                const resp = await fetch('/gerar_prompt', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({tipo: tipo})
                });
                
                const json = await resp.json();
                outputPrompt.value = json.prompt;
                botoesAcoes.style.display = 'flex';
                
            } catch (error) {
                outputPrompt.value = 'Erro ao gerar prompt. Clique novamente no card para tentar novamente.';
                console.error('Erro ao gerar prompt:', error);
            } finally {
                outputPrompt.style.opacity = '1';
            }
        }

        // Remover a função do botão gerar (não é mais necessária)
        // document.getElementById('btnGerar').onclick = ...

        // Função para copiar prompt
        document.getElementById('btnCopiar').onclick = async function() {
            const textarea = document.getElementById('outputPrompt');
            
            try {
                // Usar a API moderna de clipboard se disponível
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(textarea.value);
                    this.textContent = 'Copiado!';
                } else {
                    // Fallback para dispositivos mais antigos
                    textarea.select();
                    textarea.setSelectionRange(0, 99999); // Para mobile
                    
                    const successful = document.execCommand('copy');
                    if (successful) {
                        this.textContent = 'Copiado!';
                    } else {
                        // Se falhar, mostrar o texto selecionado para cópia manual
                        alert('Selecione e copie o texto manualmente (Ctrl+C ou Cmd+C)');
                        return;
                    }
                }
                
                setTimeout(() => {
                    this.textContent = 'Copiar Prompt';
                }, 2000);
            } catch (err) {
                // Em caso de erro, selecionar o texto para cópia manual
                textarea.select();
                textarea.setSelectionRange(0, 99999);
                alert('Selecione e copie o texto manualmente (Ctrl+C ou Cmd+C)');
            }
        };

        // Função para abrir plataformas de IA
        function abrirIA(plataforma) {
            const url = urlsIA[plataforma];
            if (url) {
                // Adicionar pequeno delay para melhor feedback em mobile
                const button = event.target;
                button.style.transform = 'scale(0.95)';
                
                setTimeout(() => {
                    button.style.transform = '';
                    window.open(url, '_blank');
                }, 100);
            }
        }
        
        // Prevenir zoom em inputs em iOS
        document.addEventListener('touchstart', function(e) {
            if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') {
                e.target.style.fontSize = '16px';
            }
        });
        
        // Função para copiar URL
        async function copiarIP(elemento) {
            const texto = elemento.textContent;
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(texto);
                } else {
                    // Fallback para dispositivos mais antigos
                    const textArea = document.createElement('textarea');
                    textArea.value = texto;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                
                // Feedback visual
                const originalText = elemento.textContent;
                elemento.textContent = 'Copiado!';
                elemento.style.background = '#d4edda';
                
                setTimeout(() => {
                    elemento.textContent = originalText;
                    elemento.style.background = '#f8f9fa';
                }, 1500);
                
            } catch (err) {
                console.error('Erro ao copiar:', err);
                alert('Erro ao copiar. Selecione e copie manualmente.');
            }
        }
    </script>
</body>
</html>